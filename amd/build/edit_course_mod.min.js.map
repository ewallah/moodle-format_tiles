{"version":3,"sources":["../src/edit_course_mod.js"],"names":["define","$","ajax","Templates","Notification","str","url","config","stringStore","body","page","Selector","MENU_ACTION","SUBTILE","SPACER","AVAIL_INFO","ACTIVITY_INSTANCE","INSTANCE_NAME","SECTION_CM_EDIT_ACTIONS","EDITING_MOVE","LABEL_CONVERT","CM_EDIT_ACTION","ACTIVITY_ICON","EDITING_DELETE","SECTION_MAIN","STEALTH_UNAVAIL_LINK","ClassNames","SHOW","HIDE","FA_EYE_SLASH","FA_EYE","DIMMED","EDITING","ACTIVITY","LABEL","SECTION_DRAGGABLE","Event","CLICK","MODULE_ADDED","MOUSEDOWN","legacyToggleHideCourseMod","clickEvent","clickedLink","currentTarget","actions","attr","changeTo","old","hide","preventDefault","promises","call","methodname","args","id","action","done","HTMLresult","removeClass","addClass","replace","menuActionText","find","subtile","closest","html","show","newAvailabilityInfo","oldAvailabilityInfo","length","replaceWith","appendTo","fail","window","location","legacyFileTypeFromIconURL","iconURL","powerpoint","document","spreadsheet","archive","pdf","mp3","mpeg","jpeg","text","split","slice","legacyCourseModGetSubtileAttributes","cmObject","modResourceType","displayname","other","each","index","editItem","remove","returnData","cmid","modtitle","cmeditmenu","outerHTML","cmmove","modname","modnameDisplay","useSubtiles","isEmbeddedResource","clickable","isediting","visible","isPdf","legacyHandleCmAddedToPage","courseId","addedCourseModule","sectionAddedTo","msg","hasClass","href","indexOf","wwwroot","reload","children","append","imageUrl","loading","previousNonSpacer","prevAll","not","first","prevUntil","stringKey","get_string","string","substring","cmAttributes","render","newItem","animate","scrollTop","offset","top","x","fadeOut","fadeIn","on","css","init","displaySection","convertedLabel","ready","Y","use","M","course","setTimeout","coursebase","registermodules","e","confirm","areyousure","converttopage_confirm","yes","no","newPage","event","deletedItem","get_strings","key","component","s"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* global setTimeout, document, window, Y, M */\n/* eslint space-before-function-paren: 0 */\n\n/**\n * Javascript Module to handle edit actions on course modules.\n *\n * @module      edit_course_mod\n * @package     course/format\n * @subpackage  tiles\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       Moodle 3.3\n */\n\ndefine([\"jquery\", \"core/ajax\", \"core/templates\", \"core/notification\", \"core/str\", \"core/url\", \"core/config\"],\n    function ($, ajax, Templates, Notification, str, url, config) {\n        \"use strict\";\n\n        /**\n         * Keep references for all modals we have already added to the page,\n         * so that we can relaunch then if needed without asking server\n         * @type {{}}\n         */\n        var stringStore = {};\n\n        var body = $(\"html,body\");\n        var page = $(\"#page\");\n\n        var Selector = {\n            MENU_ACTION: \".menu-action-text\",\n            SUBTILE: \".subtile\",\n            SPACER: \".spacer\",\n            AVAIL_INFO: \".availabilityinfo\",\n            ACTIVITY_INSTANCE: \".subtile-activityinstance\",\n            INSTANCE_NAME: \".instancename\",\n            SECTION_CM_EDIT_ACTIONS: \".section-cm-edit-actions\",\n            EDITING_MOVE: \".editing_move\",\n            LABEL_CONVERT: \".editing_labelconvert\",\n            CM_EDIT_ACTION: \".cm-edit-action\",\n            ACTIVITY_ICON: \".activityicon\",\n            EDITING_DELETE: \".editing_delete\",\n            SECTION_MAIN: \".section.main\",\n            STEALTH_UNAVAIL_LINK: '.editing_makeunavailable'\n        };\n\n        var ClassNames = {\n            SHOW: \"show\",\n            HIDE: \"hide\",\n            FA_EYE_SLASH: \"fa-eye-slash\",\n            FA_EYE: \"fa-eye\",\n            DIMMED: \"dimmed\",\n            EDITING: \"editing_\",\n            ACTIVITY: \"activity\",\n            LABEL: \"label\",\n            SECTION_DRAGGABLE: \"sectiondraggable\"\n        };\n\n        var Event = {\n            CLICK: \"click\",\n            MODULE_ADDED: \"filter-content-updated\",\n            MOUSEDOWN: \"mousedown\"\n        };\n\n        /**\n         * This dates from before the change to using AJAX for editing teacher content.\n         * Once the new functionality is no longer experimental, this can be removed.\n         *\n         *  If an editing user clicks a show/hide menu item on a course module\n         * @param {object} clickEvent\n         */\n        var legacyToggleHideCourseMod = function (clickEvent) {\n            var clickedLink = $(clickEvent.currentTarget);\n            var actions;\n            if (clickedLink.attr(\"data-action\") === \"tiles-hide\") {\n                actions = {changeTo: ClassNames.HIDE, old: ClassNames.SHOW};\n                $(Selector.STEALTH_UNAVAIL_LINK).hide();\n            } else if (clickedLink.attr(\"data-action\") === \"tiles-show\") {\n                actions = {changeTo: ClassNames.SHOW, old: ClassNames.HIDE};\n            }\n            if (actions) {\n                clickEvent.preventDefault();\n                clickedLink.attr(\"data-action\", \"tiles-\" + actions.old);\n                var promises = ajax.call([{\n                    methodname: \"core_course_edit_module\",\n                    args: {\n                        id: clickedLink.attr(\"data-cmid\"),\n                        action: actions.changeTo\n                    }\n                }], true);\n                promises[0].done(function (HTMLresult) {\n                    // This core web service returns the new HTML for the course module.\n                    // However we don't want to use it, as we are using different templates for the CM.\n                    // To save re-implementing the core function, we replace elements in the old HTML instead of new.\n                    // TODO - consider if it is preferable to re-implement the core function or re-render CM.\n\n                    clickedLink.removeClass(ClassNames.EDITING + actions.old).addClass(ClassNames.EDITING + actions.changeTo);\n                    clickedLink.attr(\n                        \"href\", clickedLink.attr(\"href\").replace(\"&\" + actions.old + \"=\", \"&\" + actions.changeTo + \"=\")\n                    );\n                    // Replace the string on the menu item to \"Hide\" or \"Show\", and icon, as appropriate to reflect new state.\n                    var menuActionText = clickedLink.find(Selector.MENU_ACTION);\n                    var subtile = clickedLink.closest(Selector.SUBTILE);\n                    if (actions.changeTo === ClassNames.SHOW) {\n                        menuActionText.html(menuActionText.html().replace(stringStore.show, stringStore.hide));\n                        clickedLink.find(\"i\").removeClass(ClassNames.FA_EYE_SLASH).addClass(ClassNames.FA_EYE);\n                        subtile.removeClass(ClassNames.DIMMED); // Dim the related sub-tile.\n                    } else if (actions.changeTo === ClassNames.HIDE) {\n                        menuActionText.html(menuActionText.html().replace(stringStore.hide, stringStore.show));\n                        clickedLink.find(\"i\").removeClass(ClassNames.FA_EYE).addClass(ClassNames.FA_EYE_SLASH); // Replace the icon.\n                        subtile.addClass(ClassNames.DIMMED);\n                    }\n                    // Now replace the availability info displayed on the sub tile.\n                    var newAvailabilityInfo = $(HTMLresult).find(Selector.AVAIL_INFO);\n                    var oldAvailabilityInfo = subtile.find(Selector.AVAIL_INFO);\n                    if (newAvailabilityInfo) {\n                        if (oldAvailabilityInfo.length) {\n                            oldAvailabilityInfo.replaceWith(newAvailabilityInfo);\n                        } else {\n                            newAvailabilityInfo.appendTo(subtile.find(Selector.ACTIVITY_INSTANCE));\n                        }\n                    } else {\n                        oldAvailabilityInfo.hide();\n                    }\n                });\n                promises[0].fail(function () {\n                    // We failed to use JS to handle so refer user to the original PHP URL instead.\n                    window.location.replace(clickedLink.attr(\"href\"));\n                });\n            }\n        };\n\n        /**\n         * This dates from before the change to using AJAX for editing teacher content.\n         * Once the new functionality is no longer experimental, this can be removed.\n         *\n         * When a new item is added to course by drag drop, we have to convert it to subtile format\n         * For this we need to know which class to add to it (e.g. ppt) so that it has the correct icon\n         * and colouring on the sub tile.  The easiest way to work this out is to use the icon URL\n         * from the standard activity\n         * @param {string} iconURL the icon URL oe.g. [wwwroot]/theme/image.php/boost/core/1535409577/f/pdf-24\n         * @returns {string} the type e.g. 'pdf'\n         */\n        var legacyFileTypeFromIconURL = function (iconURL) {\n            var extensions = {\n                powerpoint: \"ppt\",\n                document: \"doc\",\n                spreadsheet: \"xls\",\n                archive: \"zip\",\n                pdf: \"pdf\",\n                mp3: \"mp3\",\n                mpeg: \"mp4\",\n                jpeg: \"jpeg\",\n                text: \"txt\",\n                html: \"html\"\n            };\n            // Return the type corresponding to the last item in the URL, excluding anything after '-'.\n            return extensions[iconURL.split(\"/\").slice(-1)[0].split(\"-\")[0]];\n        };\n\n        /**\n         * This dates from before the change to using AJAX for editing teacher content.\n         * Once the new functionality is no longer experimental, this can be removed.\n         *\n         * When a new course module is dragged and dropped into the course\n         * we need its attributes so that we can convert it into a sub tile if needed\n         * This assembles them ready to be sent to the mustache template\n         *\n         * @param {object} cmObject the jquery object added\n         * @param {string} modResourceType type of module e.g. 'page'\n         * @param {string} displayname e.g. \"Spreadsheet\"\n         * @returns {object} promise for the module attributes\n         */\n        var legacyCourseModGetSubtileAttributes = function (cmObject, modResourceType, displayname) {\n            // TODO would be better to handle this whole function with a web service for cm data?\n            if (displayname === undefined || displayname === \"\") {\n                // Failed to get string for this type\n                displayname = stringStore.other; // Use \"other\" instead of proper word.\n            }\n            // We take the course module edit menu from the new CM which core added to the course.\n            // We remove the data-action attributes from the hide menu item, as we dont want it to call JS.\n            // if it called JS, the result would not only hide the item (good) but re-render it using standard core template (bad).\n            cmObject.find('a.cm-edit-action').each(function (index, editItem) {\n                $(editItem).attr('data-action', '');\n            });\n            cmObject.find('a.editing_moveright').remove(); // We do not use this with subtiles (indent).\n            var returnData = {\n                cmid: cmObject.attr(\"id\").split(\"-\").slice(-1)[0], // Last item.\n                modtitle: cmObject.find(Selector.INSTANCE_NAME).html().split(\"<\")[0],\n                cmeditmenu: cmObject.find(Selector.SECTION_CM_EDIT_ACTIONS)[0].outerHTML.replace(/\\n/g, \"\"),\n                cmmove: cmObject.find(Selector.EDITING_MOVE)[0].outerHTML,\n                modname: \"resource\",\n                modResourceType: modResourceType,\n                modnameDisplay: displayname,\n                useSubtiles: 1,\n                isEmbeddedResource: 0,\n                clickable: 1,\n                isediting: 1,\n                visible: 1\n            };\n            returnData.isPdf = returnData.modResourceType === \"pdf\";\n            return returnData;\n        };\n\n        /**\n         * This dates from before the change to using AJAX for editing teacher content.\n         * Once the new functionality is no longer experimental, this can be removed.\n         * @param {number} courseId\n         * @param {object} addedCourseModule\n         * @param {object} sectionAddedTo\n         * @param {string} msg\n         */\n        var legacyHandleCmAddedToPage = function(courseId, addedCourseModule, sectionAddedTo, msg) {\n            if (sectionAddedTo.hasClass(ClassNames.SECTION_DRAGGABLE)\n                && window.location.href.indexOf('expand=') === -1) {\n                // An item has been dragged into a section when we are on the multi tile screen.\n                // However the section is not yet expanded.\n                // Therefore expand the section it has been dragged into so teacher can see it.\n                window.location = config.wwwroot + '/course/view.php?id=' + courseId\n                    + \"&expand=\" + sectionAddedTo.attr(\"data-section\")\n                    + \"#section-\" + sectionAddedTo.attr(\"data-section\");\n            } else if (addedCourseModule.hasClass(ClassNames.LABEL)\n                && addedCourseModule.closest('ul').hasClass('subtiles')) {\n                // The mod type is probably an image (being dragged in to the course.\n                // When this happens, core adds a label and puts it in.\n                // So allow this to happen, then reload the page.\n                // This ensures the image displays correctly (only bother if we are using subtiles).\n                window.location.reload();\n            } else if (\n                addedCourseModule.hasClass(ClassNames.ACTIVITY) && addedCourseModule.closest('ul').hasClass('subtiles')\n            ) {\n                // Only course modules and not (for example) user tours modal.\n                // If we are not using sub tiles in section zero, don't bother changing it there.\n                addedCourseModule.children().hide();\n                addedCourseModule.append($(\"<img/>\")\n                    .attr(\"src\", url.imageUrl(\"loading\", \"format_tiles\"))\n                    .addClass(\"loading-subtile\").attr('title', stringStore.loading));\n                var previousNonSpacer = addedCourseModule.prevAll(Selector.SUBTILE).not(Selector.SPACER).first();\n                addedCourseModule.prevUntil(previousNonSpacer, Selector.SPACER).hide();\n\n                // Get cmid, modtitle, modnameDisplay, cmeditmenu of ite just added to course by AJAX.\n                // Re-render it in the correct style for this format (as sub tile).\n                var modResourceType = legacyFileTypeFromIconURL(addedCourseModule.find(Selector.ACTIVITY_ICON).attr(\"src\"));\n                if (modResourceType === undefined) {\n                    // We have probably dragged an image into the course and chosen to add it as a file resource.\n                    window.location.reload();\n                }\n                var stringKey = \"displaytitle_mod_\" + modResourceType;\n                if (stringStore[stringKey] === undefined) {\n                    str.get_string(stringKey, \"format_tiles\")\n                        .done(function (string) {\n                            if (string.substring(0, 2) !== \"[[\") {\n                                // The [[ means unknown string.\n                                stringStore[stringKey] = string;\n                            } else {\n                                string = \"\";\n                            }\n                            var cmAttributes = legacyCourseModGetSubtileAttributes(\n                                addedCourseModule, modResourceType, string\n                            );\n                            Templates.render(\n                                \"format_tiles/course_module\",\n                                cmAttributes\n                            ).done(function (html) {\n                                addedCourseModule.replaceWith(html);\n                                // Flash the new item to bring attention to it.\n                                var newItem = $(\"#\" + $(msg).attr(\"id\"));\n                                body.animate({scrollTop: newItem.offset().top - 130}, \"fast\");\n                                for (var x = 0; x < 3; x++) {\n                                    newItem.fadeOut(300).fadeIn(300);\n                                }\n                                // The move cm icon will not work, so if is clicked, we refresh page so it works.\n                                $('#module-' + cmAttributes.cmid).find('.editing_move')\n                                    .attr('data-action', '')\n                                    .on(Event.MOUSEDOWN, function() {\n                                        window.location.reload();\n                                    });\n                            });\n                        });\n                } else {\n                    var cmAttributes = legacyCourseModGetSubtileAttributes(\n                        addedCourseModule, modResourceType, stringStore[stringKey]\n                    );\n                    Templates.render(\"format_tiles/course_module\", cmAttributes).done(function (html) {\n                        addedCourseModule.replaceWith(html);\n                        // The move cm icon will not work, so if is clicked, we refresh page so it works.\n                        $('#module-' + cmAttributes.cmid).find('.editing_move')\n                            .attr('data-action', '')\n                            .on(Event.MOUSEDOWN, function() {\n                                window.location.reload();\n                            });\n                    });\n                }\n            } else {\n                // We are leaving the course module in the old style as added by core drag-drop.\n                // Adjust the inner div styling slightly to make it consistent with the others.\n                addedCourseModule.find('div.mod-indent-outer')\n                    .css('position', 'absolute').css('top', '0')\n                    .css('width', '100%').css('padding-left', '0');\n            }\n        };\n\n        return {\n            init: function (courseId, displaySection, convertedLabel) {\n                $(document).ready(function () {\n                    // This is to cover something which can happen when dragging and dropping a course module.\n                    // In course/amd/src/action.js is a method called M.course.coursebase.register_module.\n                    // This is called on each drag drop and results in tbe course module which is drag dropped,\n                    // and refreshed afterwards, changing  it in the process to a non tiles format.  This stops that.\n                    // Ugly but seems to work and can't see another easy way to stop it firing.\n                    Y.use(\"moodle-course-coursebase\", function () {\n                        // Clear existing instance variable to stop it - delay is to ensure page is loaded.\n                        if (typeof M.course !== \"undefined\") {\n                            setTimeout(function () {\n                                M.course.coursebase.registermodules = [];\n                            }, 500);\n                        }\n                    });\n\n                    // User wants to convert a label to a page using action menu on label.\n                    $(Selector.LABEL_CONVERT).on(Event.CLICK, function (e) {\n                        e.preventDefault();\n                        Notification.confirm(\n                            stringStore.areyousure,\n                            stringStore.converttopage_confirm,\n                            stringStore.yes,\n                            stringStore.no,\n                            function () {\n                                window.location = $(e.currentTarget).attr(\"href\");\n                            },\n                            null\n                        );\n                    });\n\n                    if (convertedLabel !== 0) {\n                        // User has just converted a label to a page, so highlight the new item they just converted.\n                        var newPage = $(\"#module-\" + convertedLabel);\n                        body.animate({scrollTop: newPage.offset().top - 130}, \"fast\");\n                        for (var x = 0; x < 3; x++) {\n                            newPage.fadeOut(300).fadeIn(300);\n                        }\n                    }\n\n                    // If user clicks show/hide on a course module.\n                    page.on(\"click\", Selector.CM_EDIT_ACTION, function (e) {\n                        legacyToggleHideCourseMod(e);\n                    });\n\n                    // Listen for new items being added to course by drag drop and convert them to subtile format.\n                    // Otherwise the core JS will add them to the page in standard \"list\" format.\n                    // This can be moved to edit_course once legacy functions are removed.\n                    $(document).on(Event.MODULE_ADDED, function (event, msg) {\n                        var addedCourseModule = $(\"#\" + $(msg).attr(\"id\"));\n                        var sectionAddedTo = addedCourseModule.closest(Selector.SECTION_MAIN);\n                        if (sectionAddedTo.length >= 1) {\n                            legacyHandleCmAddedToPage(courseId, addedCourseModule, sectionAddedTo, msg);\n                        }\n                    });\n\n                    // If the teacher deletes a subtile, we need to hide any \"spacer\" subtiles directly before it.\n                    // We want none between what was the previous activity to the one we just deleted, and the next.\n                    page.on(Event.CLICK, Selector.EDITING_DELETE, function (e) {\n                        var deletedItem = $(e.currentTarget).closest(\"li\" + ClassNames.ACTIVITY);\n                        var previousNonSpacer = deletedItem.prevAll(Selector.SUBTILE).not(Selector.SPACER).first();\n                        if (deletedItem.hasClass(ClassNames.LABEL)) {\n                            deletedItem.prevUntil(previousNonSpacer, Selector.SPACER).hide();\n                        }\n                    });\n\n                    str.get_strings([\n                        {key: \"yes\"},\n                        {key: \"no\"},\n                        {key: \"show\"},\n                        {key: \"hide\"},\n                        {key: \"converttopage_confirm\", component: \"format_tiles\"},\n                        {key: \"areyousure\"},\n                        {key: \"complete\", component: \"format_tiles\"},\n                        {key: \"fileaddedtobottom\", component: \"format_tiles\"},\n                        {key: \"loading\", component: \"format_tiles\"}\n                    ]).done(function (s) {\n                        stringStore = {\n                            \"yes\": s[0],\n                            \"no\": s[1],\n                            \"show\": s[2],\n                            \"hide\": s[3],\n                            \"converttopage_confirm\": s[4],\n                            \"areyousure\": s[5],\n                            \"complete\": s[6],\n                            \"fileaddedtobottom\": s[7],\n                            \"loading\": s[8]\n                        };\n                    });\n                });\n            }\n        };\n    }\n);"],"file":"edit_course_mod.min.js"}