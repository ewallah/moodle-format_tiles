{"version":3,"sources":["../src/course_mod_modal.js"],"names":["define","$","modalFactory","config","Templates","Notification","ajax","modalStore","loadingIconHtml","win","window","courseId","Selector","toggleCompletion","modal","modalDialog","modalBody","sectionMain","pageContent","regionMain","completionState","cmModalClose","cmModal","moodleMediaPlayer","urlModalLoadWarning","closeBtn","ACTIVITY","URLACTIVITYPOPUPLINK","newWindowButton","modalHeader","embedModuleButtons","LaunchModalDataActions","launchResourceModal","launchModuleModal","launchUrlModal","modalMinWidth","Math","min","width","stopAllVideosOnDismiss","iframes","find","length","click","e","currentTarget","closest","each","index","iframe","attr","objects","object","html","launchCourseResourceModal","clickedCmObject","cmid","create","type","types","DEFAULT","title","body","done","setLarge","show","modalRoot","root","addClass","templateData","id","pluginfileUrl","objectType","height","round","tileid","isediting","sesskey","modtitle","wwwroot","showDownload","showNewWindow","completionInUseForCm","render","setBody","animate","fail","exception","inverseCompletionState","parseInt","completionstate","completionicon","completionstateInverse","completionIsManual","append","detach","appendTo","launchEmbeddedUrlModal","modalWidth","modalHeight","secondaryurl","setTimeout","remove","not","removeClass","resizeModal","mediaPlayer","child","css","iframeWidth","max","iframeHeight","launchCourseActivityModal","methodName","call","methodname","args","courseid","response","content","ex","developerdebug","location","launchUrlPopUp","clickedActivity","stopPropagation","preventDefault","require","completion","markAsAutoCompleteInUI","newWin","open","focus","popUpLink","Str","get_strings","key","component","s","alert","init","courseIdInit","isEditing","document","ready","modalSelectors","Object","keys","map","join","on","tgt","existingModal","Error","catch"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/* global document, window */\n/* eslint space-before-function-paren: 0 */\n\n/**\n * Javascript Module to handle rendering of course modules (e.g. resource/PDF, resource/html, page) in modal windows\n *\n * When the user clicks a PDF course module subtile or old style resource\n * if we are using modals for it (e.g. PDF) , create, populate, launch and size the modal\n *\n * @module      course_mod_modal\n * @package     course/format\n * @subpackage  tiles\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       Moodle 3.3\n */\n\ndefine([\"jquery\", \"core/modal_factory\", \"core/config\", \"core/templates\", \"core/notification\", \"core/ajax\"],\n    function ($, modalFactory, config, Templates, Notification, ajax) {\n        \"use strict\";\n\n        /**\n         * Keep references for all modals we have already added to the page,\n         * so that we can relaunch then if needed\n         * @type {{}}\n         */\n        var modalStore = {};\n        var loadingIconHtml;\n        var win = $(window);\n        var courseId;\n\n        var Selector = {\n            toggleCompletion: \".togglecompletion\",\n            modal: \".modal\",\n            modalDialog: \".modal-dialog\",\n            modalBody: \".modal-body\",\n            sectionMain: \".section.main\",\n            pageContent: \"#page-content\",\n            regionMain: \"#region-main\",\n            completionState: \"#completionstate_\",\n            cmModalClose: \".embed_cm_modal .close\",\n            cmModal: \".embed_cm_modal\",\n            moodleMediaPlayer: \".mediaplugin_videojs\",\n            urlModalLoadWarning: \"#embed-url-error-msg-\",\n            closeBtn: \"button.close\",\n            ACTIVITY: \"li.activity\",\n            URLACTIVITYPOPUPLINK: \".activity.modtype_url.urlpopup a\",\n            newWindowButton: \".button_expand\",\n            modalHeader: \".modal-header\",\n            embedModuleButtons: \".embed-module-buttons\"\n        };\n\n        var LaunchModalDataActions = {\n            launchResourceModal: \"launch-tiles-resource-modal\",\n            launchModuleModal: \"launch-tiles-module-modal\",\n            launchUrlModal: \"launch-tiles-url-modal\"\n        };\n\n        var modalMinWidth = function () {\n            return Math.min(win.width(), 1000);\n        };\n\n        /**\n         * Some modals contain videos in iframes or objects, which need to stop playing when dismissed.\n         * @param {object} modal the modal which contains the video.\n         */\n        var stopAllVideosOnDismiss = function(modal) {\n            var iframes = modal.find(\"iframe\");\n            if (iframes.length > 0) {\n                modal.find(Selector.closeBtn).click(function(e) {\n                    $(e.currentTarget).closest(Selector.cmModal).find(\"iframe\").each(function (index, iframe) {\n                        iframe = $(iframe);\n                        iframe.attr('src', iframe.attr(\"src\"));\n                    });\n                });\n            }\n            var objects = modal.find(\"object\");\n            if (objects.length > 0) {\n                // In this case resetting the URL does not seem to work so we clear it and clear modal from storage.\n                modal.find(Selector.closeBtn).click(function(e) {\n                    var modal = $(e.currentTarget).closest(Selector.cmModal);\n                    modal.find(\"object\").each(function (index, object) {\n                        object = $(object);\n                        object.attr('data', \"\");\n                    });\n                    modalStore[modal.attr(\"data-cmid\")] = undefined;\n                });\n            }\n\n            var moodleMediaPlayer = modal.find(Selector.moodleMediaPlayer);\n            if (moodleMediaPlayer.length > 0) {\n                modal.find(Selector.closeBtn).click(function() {\n                    modal.find(Selector.moodleMediaPlayer).html(\"\");\n                });\n                // Ensure we create a new modal next time.\n                modalStore[modal.attr(\"data-cmid\")] = undefined;\n            }\n        };\n\n        /**\n         * Launch a Course Resource Modal if we have it already, or make one and launch e.g. for PDF\n         * @param {object} clickedCmObject the course module object which was clicked\n         * @returns {boolean} if successful or not\n         */\n        var launchCourseResourceModal = function (clickedCmObject) {\n            var cmid = clickedCmObject.attr(\"data-cmid\");\n            modalFactory.create({\n                type: modalFactory.types.DEFAULT,\n                title: clickedCmObject.attr(\"data-title\"),\n                body: loadingIconHtml\n            }).done(function (modal) {\n                modalStore[cmid] = modal;\n                modal.setLarge();\n                modal.show();\n                var modalRoot = $(modal.root);\n                modalRoot.attr(\"id\", \"embed_mod_modal_\" + cmid);\n                modalRoot.attr(\"data-cmid\", cmid);\n                modalRoot.addClass(\"embed_cm_modal\");\n\n                // Render the modal body and set it to the page.\n                // First a blank template data object.\n                var templateData = {\n                    id: cmid,\n                    pluginfileUrl: clickedCmObject.attr(\"data-url\"),\n                    objectType: \"text/html\",\n                    width: \"100%\",\n                    height: Math.round(win.height() - 60), // Embedded object height in modal - make as high as poss.\n                    cmid: cmid,\n                    tileid: clickedCmObject.closest(Selector.sectionMain).attr(\"data-section\"),\n                    isediting: 0,\n                    sesskey: config.sesskey,\n                    modtitle: clickedCmObject.attr(\"data-title\"),\n                    config: {wwwroot: config.wwwroot},\n                    showDownload: 0,\n                    showNewWindow: 0,\n                    completionInUseForCm: 0\n                };\n\n                // If it's a PDF in this modal, change from the defaults assigned above.\n                if (clickedCmObject.attr('data-modtype') === \"resource_pdf\") {\n                    templateData.objectType = 'application/pdf';\n                    templateData.showDownload = 1;\n                    templateData.showNewWindow = 1;\n                }\n\n                Templates.render(\"format_tiles/embed_file_modal_body\", templateData).done(function (html) {\n                    modal.setBody(html);\n                    modalRoot.find(Selector.modalBody).animate({\"min-height\": Math.round(win.height() - 60)}, \"fast\");\n\n                    if (clickedCmObject.attr('data-modtype') === \"resource_html\") {\n                        // HTML files only - set widths to 100% since they may contain embedded videos etc.\n                        modalRoot.find(Selector.modal).animate({\"max-width\": \"100%\"}, \"fast\");\n                        modalRoot.find(Selector.modalDialog).animate({\"max-width\": \"100%\"}, \"fast\");\n                        modalRoot.find(Selector.modalBody).animate({\"max-width\": \"100%\"}, \"fast\");\n                        stopAllVideosOnDismiss(modalRoot);\n                    } else {\n                        // Otherwise (e.g for PDF) we don't need 100% width.\n                        modalRoot.find(Selector.modal).animate({\"max-width\": modalMinWidth()}, \"fast\");\n                        // We do modal-dialog too since Moove theme uses it.\n                        modalRoot.find(Selector.modalDialog).animate({\"max-width\": modalMinWidth()}, \"fast\");\n                    }\n\n                }).fail(Notification.exception);\n                // Render the modal header / title and set it to the page.\n                if (clickedCmObject.find(Selector.toggleCompletion).length !== 0) {\n                    var inverseCompletionState = parseInt(\n                        $(Selector.completionState + cmid).attr(\"value\")\n                    );\n                    templateData.completionInUseForCm = 1;\n                    templateData.completionstate = 1 - inverseCompletionState;\n                    templateData.completionicon = inverseCompletionState === 1 ? 'n' : 'y';\n                    templateData.completionstateInverse = inverseCompletionState;\n                    templateData.completionIsManual = clickedCmObject\n                        .find(Selector.toggleCompletion).attr(\"data-ismanual\");\n                }\n                Templates.render(\"format_tiles/embed_module_modal_header_btns\", templateData).done(function (html) {\n                    modalRoot.find(Selector.modalHeader).append(html);\n                    modalRoot.find(Selector.closeBtn).detach().appendTo(modalRoot.find(Selector.embedModuleButtons));\n                }).fail(Notification.exception);\n\n                return true;\n            });\n            return false;\n        };\n\n        /**\n         * Launch an embedded URL Modal (URL displays in iframe) if we have it already, or make one and launch.\n         * This is only used if the URL activity is set to Display: embed.  The reason is that most websites disallow iframes.\n         * See https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options.\n         * @param {object} clickedCmObject the course module object which was clicked\n         * @returns {boolean} if successful or not\n         */\n        var launchEmbeddedUrlModal = function (clickedCmObject) {\n            var cmid = clickedCmObject.attr(\"data-cmid\");\n            modalFactory.create({\n                type: modalFactory.types.DEFAULT,\n                title: clickedCmObject.attr(\"data-title\"),\n                body: loadingIconHtml\n            }).done(function (modal) {\n                modalStore[cmid] = modal;\n                modal.setLarge();\n                modal.show();\n                var modalRoot = $(modal.root);\n                modalRoot.attr(\"id\", \"embed_mod_modal_\" + cmid);\n                modalRoot.attr(\"data-cmid\", cmid);\n                modalRoot.addClass(\"embed_cm_modal\");\n\n                // Render the modal body and set it to the page.\n                // First a blank template data object.\n\n                var modalWidth = Math.round(win.width() * 0.9);\n                var modalHeight = Math.round(win.height() * 0.9);\n                var templateData = {\n                    id: cmid,\n                    pluginfileUrl: clickedCmObject.attr(\"data-url\"),\n                    objectType: \"text/html\",\n                    width: modalWidth - 30,\n                    height: modalHeight - 30,\n                    cmid: cmid,\n                    tileid: clickedCmObject.closest(Selector.sectionMain).attr(\"data-section\"),\n                    isediting: 0,\n                    sesskey: config.sesskey,\n                    modtitle: clickedCmObject.attr(\"data-title\"),\n                    config: {wwwroot: config.wwwroot},\n                    showDownload: 0,\n                    showNewWindow: 1,\n                    completionInUseForCm: 0,\n                    secondaryurl: clickedCmObject.closest(Selector.ACTIVITY).attr(\"data-url-secondary\")\n                };\n\n                Templates.render(\"format_tiles/embed_url_modal_body\", templateData).done(function (html) {\n                    modal.setBody(html);\n                    modalRoot.find(Selector.modalBody).animate({\"min-height\": modalHeight}, \"fast\");\n                    modalRoot.find(Selector.modal).animate({\"max-width\": modalWidth}, \"fast\");\n                    modalRoot.find(Selector.modalDialog).animate({\"max-width\": modalWidth}, \"fast\");\n                    modalRoot.find(Selector.modalBody).animate({\"max-width\": modalWidth}, \"fast\");\n                    stopAllVideosOnDismiss(modalRoot);\n                    modalRoot.find(Selector.modalBody).addClass(\"text-center\");\n                }).fail(Notification.exception);\n                // Render the modal header / title and set it to the page.\n                if (clickedCmObject.find(Selector.toggleCompletion).length !== 0) {\n                    var inverseCompletionState = parseInt(\n                        $(Selector.completionState + cmid).attr(\"value\")\n                    );\n                    templateData.completionInUseForCm = 1;\n                    templateData.completionstate = 1 - inverseCompletionState;\n                    templateData.completionicon = inverseCompletionState === 1 ? 'n' : 'y';\n                    templateData.completionstateInverse = inverseCompletionState;\n                    templateData.completionIsManual = clickedCmObject\n                        .find(Selector.toggleCompletion).attr(\"data-ismanual\");\n                }\n                Templates.render(\"format_tiles/embed_module_modal_header_btns\", templateData).done(function (html) {\n                    modalRoot.find(Selector.modalHeader).append(html);\n                    modalRoot.find(Selector.closeBtn).detach().appendTo(modalRoot.find(Selector.embedModuleButtons));\n                }).fail(Notification.exception);\n\n                // Listen to see if user clicks to view the modal contents in a new window.  Dismiss modal if so.\n                // Important for video which may end up playing twice otherwise.\n                setTimeout(function() {\n                    modalRoot.find(Selector.newWindowButton).click(function() {\n                        modalStore[modalRoot.attr(\"data-cmid\")] = undefined;\n                        modalRoot.remove();\n                        $(\".modal-backdrop\").not(\"#window-overlay\").removeClass(\"show\").addClass(\"hide\");\n                    });\n                }, 1000);\n\n                return true;\n            });\n            return false;\n        };\n\n        var resizeModal = function(modalRoot) {\n            modalRoot.find(Selector.modal).animate({\"max-width\": modalMinWidth()}, \"fast\");\n\n            var MODAL_MARGIN = 70;\n\n            // If the modal contains a Moodle mediaplayer div, remove the max width css rule which Moodle applies.\n            // Otherwise video will be 400px max wide.\n            var mediaPlayer = $(Selector.moodleMediaPlayer);\n            mediaPlayer.find(\"div\").each(function(index, child) {\n                $(child).css(\"max-width\", \"\");\n            });\n            if (mediaPlayer.length > 0) {\n                stopAllVideosOnDismiss(modalRoot);\n            }\n\n            // If the activity contains an iframe (e.g. is a page with a YouTube video in it), ensure modal is big enough.\n            // Do this for every iframe in the course module.\n            modalRoot.find(\"iframe\").each(function (index, iframe) {\n\n                // Get the modal.\n                var modal;\n                // Boost calls the modal \"modal dialog\" so try this first.\n                modal = modalRoot.find(Selector.modalDialog);\n\n                // If no luck, try what Clean and Adaptable do instead.\n                if (modal.length === 0) {\n                    modal = modalRoot.find(Selector.modal);\n                }\n\n                // Now check and adjust the width of the modal.\n                var iframeWidth = Math.min($(iframe).width(), win.width());\n                if (iframeWidth > modal.width() - MODAL_MARGIN) {\n                    modal.animate(\n                        {\"max-width\": Math.max(iframeWidth + MODAL_MARGIN, modalMinWidth())},\n                        \"fast\"\n                    );\n                    modalRoot.find(Selector.modal).animate(\n                        {\"max-width\": Math.max(iframeWidth + MODAL_MARGIN, modalMinWidth())},\n                        \"fast\"\n                    );\n                }\n\n                // Then the height of the modal body.\n                var iframeHeight = Math.min($(iframe).height(), win.height());\n                var modalBody = modalRoot.find(Selector.modalBody);\n                if (iframeHeight > modalBody.height() - MODAL_MARGIN) {\n                    modalBody.animate({\"min-height\": Math.min(iframeHeight + MODAL_MARGIN, win.height())}, \"fast\");\n                }\n\n                // Align the iframe in the centre of the modal.\n                modalBody.css(\"text-align\", \"center\");\n\n                stopAllVideosOnDismiss(modalRoot);\n            });\n        };\n\n        // TODO refactor these to avoid repetition.\n        /**\n         * Launch a Course activity Modal if we have it already, or make one and launch e.g. for \"Page\"\n         * @param {object} clickedCmObject the course module object which was clicked\n         * @returns {boolean} if successful or not\n         */\n        var launchCourseActivityModal = function (clickedCmObject) {\n            var cmid = clickedCmObject.attr(\"data-cmid\");\n            // TODO code envisages potentially adding in other web services for other mod types, but for now we have page only.\n            var methodName = \"format_tiles_get_mod_\" + clickedCmObject.attr(\"data-modtype\") + \"_html\";\n\n            modalFactory.create({\n                type: modalFactory.types.DEFAULT,\n                title: clickedCmObject.attr(\"data-title\"),\n                body: loadingIconHtml\n            }).done(function (modal) {\n                modalStore[cmid] = modal;\n                modal.setLarge();\n                modal.show();\n                var modalRoot = $(modal.root);\n                modalRoot.attr(\"data-cmid\", cmid);\n                modalRoot.attr(\"id\", \"embed_mod_modal_\" + cmid);\n                modalRoot.addClass(\"embed_cm_modal\");\n                modalRoot.addClass('mod_' + clickedCmObject.attr(\"data-modtype\"));\n                stopAllVideosOnDismiss(modalRoot);\n                ajax.call([{\n                    methodname: methodName,\n                    args: {\n                        courseid: courseId,\n                        cmid: cmid\n                    }\n                }])[0].done(function(response) {\n                    var templateData = {\n                        cmid: cmid,\n                        modtitle: clickedCmObject.attr(\"data-title\"),\n                        content: response.html\n                    };\n                    if (clickedCmObject.find(Selector.toggleCompletion).length !== 0) {\n                        var inverseCompletionState = parseInt(\n                            $(Selector.completionState + cmid).attr(\"value\")\n                        );\n                        templateData.completionInUseForCm = 1;\n                        templateData.completionstate = 1 - inverseCompletionState;\n                        templateData.completionstateInverse = inverseCompletionState;\n                        templateData.completionIsManual = clickedCmObject\n                            .find(Selector.toggleCompletion).attr(\"data-ismanual\");\n                        templateData.completionicon = inverseCompletionState === 1 ? 'n' : 'y';\n                    } else {\n                        templateData.completionInUseForCm = 0;\n                    }\n                    modal.setBody(templateData.content);\n                    Templates.render(\"format_tiles/embed_module_modal_header_btns\", templateData).done(function (html) {\n                        modalRoot.find(Selector.modalHeader).append(html);\n                        modalRoot.find(Selector.closeBtn).detach().appendTo(modalRoot.find(Selector.embedModuleButtons));\n                    }).fail(Notification.exception);\n\n                    resizeModal(modalRoot);\n\n                    return true;\n                }).fail(function(ex) {\n                    if (config.developerdebug !== true) {\n                        // Load the activity using PHP instead.\n                        window.location = config.wwwroot + \"/mod/\" + clickedCmObject.attr(\"data-modtype\") + \"/view.php?id=\" + cmid;\n                    } else {\n                        Notification.exception(ex);\n                    }\n                });\n            });\n            return false;\n        };\n\n        /**\n         * If a URL activity is clicked and it's been set to open in \"Pop up\" then launch a browser pop up.\n         * @param {object} e\n         */\n        var launchUrlPopUp = function (e) {\n            var clickedActivity = $(e.currentTarget).closest(Selector.ACTIVITY);\n            if (clickedActivity.attr(\"data-url\") !== undefined) {\n                e.stopPropagation();\n                e.preventDefault();\n                // Log the fact we viewed it.\n                ajax.call([{\n                    methodname: \"format_tiles_log_mod_view\", args: {\n                        courseid: courseId,\n                        cmid: clickedActivity.attr(\"data-cmid\")\n                    }\n                }])[0].done(function () {\n                    // Because we intercepted the normal event for the click, process auto completion.\n                    require([\"format_tiles/completion\"], function (completion) {\n                        completion.markAsAutoCompleteInUI(courseId, clickedActivity);\n                    });\n                    // Then open the pop up.\n                    var newWin = window.open(clickedActivity.attr(\"data-url\"));\n                    try {\n                        newWin.focus();\n                    } catch (e) {\n                        // Blocked pop-up?\n                        var popUpLink = '<div>'\n                            + '<a href=\"' + clickedActivity.attr(\"data-url\") + '\">'\n                            + clickedActivity.attr(\"data-url\")\n                            + '</a></div>';\n                        require(['core/str', 'core/notification'], function(Str, Notification) {\n                            var stringKeys = [\n                                {key: \"sectionerrortitle\", component: \"format_tiles\"},\n                                {key: \"blockedpopup\", component: \"format_tiles\"},\n                                {key: \"cancel\"}\n                            ];\n                            Str.get_strings(stringKeys).done(function (s) {\n                                Notification.alert(\n                                   s[0],\n                                    s[1] + popUpLink,\n                                    s[2]\n                                );\n                            });\n                        });\n                    }\n                }).fail(Notification.exception);\n            }\n        };\n\n        return {\n            init: function (courseIdInit, isEditing) {\n                courseId = courseIdInit;\n                $(document).ready(function () {\n                    var modalSelectors = Object.keys(LaunchModalDataActions).map(function (key) {\n                        return '[data-action=\"' + LaunchModalDataActions[key] + '\"]';\n                    }).join(\", \");\n\n                    var pageContent = $(Selector.pageContent);\n                    if (pageContent.length === 0) {\n                        // Some themes e.g. RemUI do not have a #page-content div, so use #region-main.\n                        pageContent = $(Selector.regionMain);\n                    }\n                    pageContent.on(\"click\", modalSelectors, function (e) {\n                        e.preventDefault();\n                        var tgt = $(e.currentTarget);\n                        var clickedCmObject = tgt.closest(\"li.activity\");\n\n                        // If we already have this modal on the page, launch it.\n                        var existingModal = modalStore[clickedCmObject.attr(\"data-cmid\")];\n                        if (typeof existingModal === \"object\") {\n                            existingModal.show();\n                        } else {\n                            // We don't already have it, so make it.\n                            switch (tgt.attr(\"data-action\")) {\n                                case LaunchModalDataActions.launchModuleModal:\n                                    launchCourseActivityModal(clickedCmObject);\n                                    break;\n                                case LaunchModalDataActions.launchResourceModal:\n                                    launchCourseResourceModal(clickedCmObject);\n                                    break;\n                                case LaunchModalDataActions.launchUrlModal:\n                                    launchEmbeddedUrlModal(clickedCmObject);\n                                    break;\n                                default:\n                                    throw new Error(\"Unknown modal type \" + tgt.attr(\"data-action\"));\n                            }\n                            // Log the fact we viewed it (only do this once not every time the modal launches).\n                            ajax.call([{\n                                methodname: \"format_tiles_log_mod_view\", args: {\n                                    courseid: courseId,\n                                    cmid: clickedCmObject.attr(\"data-cmid\")\n                                }\n                                }])[0].fail(Notification.exception);\n                        }\n                    });\n\n                     // Render the loading icon and append it to body so that we can use it later.\n                    Templates.render(\"format_tiles/loading\", {})\n                        .catch(Notification.exception)\n                        .done(function (html) {\n                            loadingIconHtml = html; // TODO get this from elsewhere.\n                        }).fail(Notification.exception);\n\n                    if (!isEditing) {\n                        // If a URL activity is clicked and it's been set to open in \"Pop up\" then launch a browser pop up.\n                        pageContent.on(\"click\", Selector.URLACTIVITYPOPUPLINK, function(e) {\n                            launchUrlPopUp(e);\n                        });\n                    }\n                });\n            }\n        };\n    }\n);"],"file":"course_mod_modal.min.js"}