{"version":3,"sources":["../src/filter_buttons.js"],"names":["define","$","Selector","FILTER_BUTTON","TILE","COLLAPSING","COLLAPSED","SPACER","PAGE_CONTENT","REGION_MAIN","ClassNames","SELECTED","Module","getPressedFilterButton","courseId","storageEnabled","localStorage","getItem","setPressedFilterButton","buttonId","removeItem","setItem","unCollapseTiles","tileIds","forEach","index","tileId","addClass","removeClass","setTimeout","collapseAllTiles","not","unCollapseAllTiles","init","storageEnabledLocal","document","ready","buttonAlreadyPressed","pressedButton","JSON","parse","attr","pageContent","length","on","e","button","target"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* eslint space-before-function-paren: 0 */\n// jslinit globals\n/* global localStorage, setTimeout, document*/\n\n/**\n * Javascript Module to handle filter buttons which appear above the tiles if used for format_tiles\n *\n * @module      filter_buttons\n * @package     course/format\n * @subpackage  tiles\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since Moodle 3.3\n */\n\ndefine([\"jquery\"], function ($) {\n    \"use strict\";\n\n    var Selector = {\n        FILTER_BUTTON: \".filterbutton\",\n        TILE: \".tile\",\n        COLLAPSING: \".tile-collapsing\",\n        COLLAPSED: \".tile-collapsed\",\n        SPACER: \".spacer\",\n        PAGE_CONTENT: \"#page-content\",\n        REGION_MAIN: \"#region-main\"\n    };\n\n    var ClassNames = {\n        COLLAPSING: \"tile-collapsing\",\n        COLLAPSED: \"tile-collapsed\",\n        SELECTED: \"selected\"\n    };\n\n    var Module = {\n        /**\n         * Which filter button does the user already have pressed\n         * @param {number} courseId the id of the course\n         * @param {boolean} storageEnabled whether the user's device supports local/session storage\n         * @returns {string|null} the filter button id or null if none stored\n         */\n        getPressedFilterButton: function (courseId, storageEnabled) {\n            return storageEnabled\n                ? localStorage.getItem(\"mdl-course-\" + courseId + \"-filter-btn\")\n                : null;\n        },\n\n        setPressedFilterButton: function (courseId, buttonId, storageEnabled) {\n            if (storageEnabled) {\n                if (buttonId === 0) {\n                    localStorage.removeItem(\"mdl-course-\" + courseId + \"-filter-btn\");\n                } else {\n                    localStorage.setItem(\"mdl-course-\" + courseId + \"-filter-btn\", buttonId);\n                }\n            }\n        },\n\n        /**\n         * The filter buttons at the top of the course can be used to collapse or expand tiles (animated via CSS)\n         * This function and other others below handle that when filter buttons are pressed\n         * Tried to use jquery .slideUp() / .slideDown() for this but animation was not smooth, so used this instead\n         * @param {Array|number} tileIds the tile IDs to change\n         */\n        unCollapseTiles: function (tileIds) {\n            tileIds.forEach(function(index, tileId) {\n                $(\"#tile-\" + tileIds[tileId]).addClass(ClassNames.COLLAPSING).removeClass(ClassNames.COLLAPSED);\n            });\n            setTimeout(function () {\n                $(Selector.COLLAPSING).removeClass(ClassNames.COLLAPSING);\n            }, 300);\n        },\n\n        /**\n         * Collapse all tiles in the course\n         */\n        collapseAllTiles: function () {\n            $(Selector.TILE).not($(Selector.COLLAPSED)).not($(Selector.SPACER)).addClass(ClassNames.COLLAPSING);\n            setTimeout(function () {\n                $(Selector.COLLAPSING).addClass(ClassNames.COLLAPSED).removeClass(ClassNames.COLLAPSING);\n            }, 250);\n        },\n\n        /**\n         * Un-collapse all tiles in the present course (animated via CSS) on filter button press\n         */\n        unCollapseAllTiles: function () {\n            setTimeout(function () {\n                $(Selector.COLLAPSED).addClass(ClassNames.COLLAPSING).removeClass(ClassNames.COLLAPSED);\n                setTimeout(function () {\n                    $(Selector.COLLAPSING).removeClass(ClassNames.COLLAPSING);\n                }, 250);\n            }, 250);\n        }\n    };\n    return {\n        init: function (courseId, storageEnabledLocal) {\n            $(document).ready(function () {\n                // On page load, if a filter button is already pressed according to user's local storage, press it now.\n                var buttonAlreadyPressed = Module.getPressedFilterButton(courseId, storageEnabledLocal);\n                if (buttonAlreadyPressed) {\n                    var pressedButton = $(\"#filterbutton\" + buttonAlreadyPressed);\n                    if (!pressedButton) {\n                        Module.setPressedFilterButton(courseId, buttonAlreadyPressed, 0);\n                    }\n                    $(Selector.FILTER_BUTTON).removeClass(ClassNames.SELECTED);\n                    pressedButton.addClass(ClassNames.SELECTED);\n                    Module.collapseAllTiles();\n                    setTimeout(function () {\n                        Module.unCollapseTiles(JSON.parse(pressedButton.attr(\"data-sections\")));\n                    }, 250);\n                    Module.setPressedFilterButton(courseId, buttonAlreadyPressed, storageEnabledLocal);\n                }\n\n                var pageContent = $(Selector.PAGE_CONTENT);\n                if (pageContent.length === 0) {\n                    // Some themes e.g. RemUI do not have a #page-content div, so use #region-main.\n                    pageContent = $(Selector.REGION_MAIN);\n                }\n                // When a filter button is pressed, mark it as selected and hide/unhide the related tiles.\n                // See @param buttonId {integer|string} the ID of the button pressed.\n                pageContent.on(\"click\", Selector.FILTER_BUTTON, function (e) {\n                    var button = $(e.target);\n                    var buttonId = button.attr(\"data-buttonid\");\n                    if (buttonId === \"all\" || Module.getPressedFilterButton(courseId, storageEnabledLocal) === buttonId) {\n                        // If \"All\" button is pressed, or a pressed button is pressed again, un-collapse all tiles.\n                        Module.collapseAllTiles();\n                        setTimeout(function () {\n                            Module.unCollapseAllTiles();\n                        }, 500);\n                        $(Selector.FILTER_BUTTON).removeClass(ClassNames.SELECTED);\n                        Module.setPressedFilterButton(courseId, 0, storageEnabledLocal);\n                        $(\"#filterbutton-all\").addClass(ClassNames.SELECTED);\n                    } else {\n                        // A numbered button has been pressed, so collapse all tiles then just reveal the ones we want.\n                        $(Selector.FILTER_BUTTON).removeClass(ClassNames.SELECTED);\n                        button.addClass(ClassNames.SELECTED);\n                        Module.collapseAllTiles();\n                        setTimeout(function () {\n                            Module.unCollapseTiles(JSON.parse(button.attr(\"data-sections\")));\n                        }, 250);\n                        Module.setPressedFilterButton(courseId, buttonId, storageEnabledLocal);\n                    }\n                });\n            });\n        }\n    };\n});"],"file":"filter_buttons.min.js"}