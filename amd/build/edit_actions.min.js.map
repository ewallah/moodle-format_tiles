{"version":3,"sources":["../src/edit_actions.js"],"names":["define","$","str","Notification","Selector","ACTIONAREA","CSS","EDITINPROGRESS","getModuleName","element","name","Y","use","Moodle","core_course","util","cm","getName","Node","get","confirmDeleteModule","mainelement","onconfirm","modtypename","attr","match","modulename","get_string","done","pluginname","get_strings","key","param","type","s","confirm","fail","exception","addActivitySpinner","activity","addClass","actionarea","find","spinner","M","add_spinner","show","addSectionLightbox","sectionelement","lightbox","add_lightbox","removeSpinner","delay","window","setTimeout","removeClass","hide","removeLightbox"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript Module to handle in course actions like delete / hide activity\n *\n * @module edit_actions\n * @package course/format\n * @subpackage tiles\n * @copyright 2019 David Watson {@link http://evolutioncode.uk}\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since Moodle 3.3\n */\n\n/* eslint space-before-function-paren: 0 */\n\ndefine([\"jquery\", \"core/str\", 'core/notification'], function ($, str, Notification) {\n    \"use strict\";\n    // Much of this is copied from core_course/actions because we cannot access the originals from \"Tiles\".\n    // We could reinitialise *all* sections using core, but that would create multiple listeners for each item.\n    // We want to do it instead by *section*, so we have to do it ourselves.\n\n    var Selector = {\n        ACTIONAREA: '.actions'\n    };\n\n    var CSS = {\n        EDITINPROGRESS: 'editinprogress'\n    };\n\n    /**\n     * Wrapper for Y.Moodle.core_course.util.cm.getName\n     *\n     * @param {object} element\n     * @returns {String}\n     */\n    var getModuleName = function(element) {\n        var name = '';\n        Y.use('moodle-course-util', function(Y) {\n            name = Y.Moodle.core_course.util.cm.getName(Y.Node(element.get(0)));\n        });\n        return name;\n    };\n\n    /**\n     * Displays the delete confirmation to delete a module\n     *\n     * @param {object} mainelement activity element we perform action on\n     * @param {function} onconfirm function to execute on confirm\n     */\n    var confirmDeleteModule = function(mainelement, onconfirm) {\n        var modtypename = mainelement.attr('class').match(/modtype_([^\\s]*)/)[1];\n        var modulename = getModuleName(mainelement);\n\n        str.get_string('pluginname', modtypename).done(function(pluginname) {\n            var plugindata = {\n                type: pluginname,\n                name: modulename\n            };\n            str.get_strings([\n                {key: 'confirm'},\n                {\n                    key: (modulename === null ? 'deletechecktype' : 'deletechecktypename'),\n                    param: plugindata\n                },\n                {key: 'yes'},\n                {key: 'no'}\n            ]).done(function(s) {\n                    Notification.confirm(s[0], s[1], s[2], s[3], onconfirm);\n            }).fail(\n                Notification.exception\n            );\n        });\n    };\n\n    /**\n     * Wrapper for M.util.add_spinner for an activity\n     *\n     * @param {object} activity\n     * @returns {Node}\n     */\n    var addActivitySpinner = function(activity) {\n        activity.addClass(CSS.EDITINPROGRESS);\n        var actionarea = activity.find(Selector.ACTIONAREA).get(0);\n        if (actionarea) {\n            var spinner = M.util.add_spinner(Y, Y.Node(actionarea));\n            spinner.show();\n            return spinner;\n        }\n        return null;\n    };\n\n    /**\n     * Wrapper for M.util.add_lightbox\n     *\n     * @param {object} sectionelement\n     * @returns {Node}\n     */\n    var addSectionLightbox = function(sectionelement) {\n        var lightbox = M.util.add_lightbox(Y, Y.Node(sectionelement.get(0)));\n        lightbox.show();\n        return lightbox;\n    };\n\n    /**\n     * Removes the spinner element\n     *\n     * @param {object} element\n     * @param {Node} spinner\n     * @param {Number} delay\n     */\n    var removeSpinner = function(element, spinner, delay) {\n        window.setTimeout(function() {\n            element.removeClass(CSS.EDITINPROGRESS);\n            if (spinner) {\n                spinner.hide();\n            }\n        }, delay);\n    };\n\n    /**\n     * Removes the lightbox element\n     *\n     * @param {Node} lightbox lighbox YUI element returned by addSectionLightbox\n     * @param {Number} delay\n     */\n    var removeLightbox = function(lightbox, delay) {\n        if (lightbox) {\n            window.setTimeout(function() {\n                lightbox.hide();\n            }, delay);\n        }\n    };\n\n    return {\n        confirmDeleteModule: function(mainelement, onconfirm) {\n            confirmDeleteModule(mainelement, onconfirm);\n        },\n        removeLightbox: function (lightbox, delay) {\n            removeLightbox(lightbox, delay);\n        },\n        removeSpinner: function (element, spinner, delay) {\n            removeSpinner(element, spinner, delay);\n        },\n        getModuleName: function (element) {\n            getModuleName(element);\n        },\n        addSectionLightbox: function(sectionelement) {\n            addSectionLightbox(sectionelement);\n        },\n        addActivitySpinner: function(activity) {\n            addActivitySpinner(activity);\n        }\n    };\n});"],"file":"edit_actions.min.js"}