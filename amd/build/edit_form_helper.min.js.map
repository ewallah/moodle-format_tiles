{"version":3,"sources":["../src/edit_form_helper.js"],"names":["define","$","Notification","str","Templates","browserStorage","init","pageType","courseDefaultIcon","courseId","sectionId","section","userId","allowphototiles","documentationUrl","document","ready","change","e","currentTarget","value","prop","enableCompBox","val","get_strings","key","component","done","s","alert","colourSelectMenu","render","colours","find","map","index","option","optselector","colour","attr","colourname","text","selected","id","replace","toArray","html","insertAfter","hide","circles","click","clicked","removeClass","addClass","fadeIn","fadeOut","body","hasClass","selectedIconName","selectBox","currentIcon","initialicon","initialname","require","iconPicker","closest","documentationurl","appendTo","cleanUpStorage"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* eslint space-before-function-paren: 0 */\n\n/**\n * Javascript Module to handle changes which are made to the course > edit settings\n * form as the user changes various options\n * e.g. if user deselects one item, this deselects another linked one for them\n * if the user picks an invalid option it will be detected by format_tiles::edit_form_validation (lib.php)\n * but this is to help them avoid triggering that if they have JS enabled\n *\n * @module      edit_form_helper\n * @package     course/format\n * @subpackage  tiles\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       Moodle 3.3\n */\n\ndefine([\"jquery\", \"core/notification\", \"core/str\", \"core/templates\", \"format_tiles/browser_storage\"],\n    function ($, Notification, str, Templates, browserStorage) {\n        \"use strict\";\n        return {\n            init: function (pageType, courseDefaultIcon, courseId, sectionId, section, userId, allowphototiles, documentationUrl) {\n                $(document).ready(function () {\n                    $(\"select#id_courseusesubtiles\").change(function (e) {\n                        if (e.currentTarget.value !== \"0\") {\n                            // We are changing to use sub tiles.\n                            // For convenience, uncheck the \"Emphasise headings with coloured tab\" box.\n                            // User can change it back if they want.\n                            $(\"input#id_courseusebarforheadings\").prop(\"checked\", false);\n                        }\n                    });\n                    $(\"select#id_courseshowtileprogress\").change(function (e) {\n                        if (e.currentTarget.value !== \"0\") {\n                            var enableCompBox = $(\"select#id_enablecompletion\");\n                            if (enableCompBox.val() === \"0\") {\n                                // We are changing to show progress on tiles\n                                // For convenience, if completion tracking if off at course level, switch it on and tell the user.\n                                // User can change it back if they want.  See under \"completion tracking > enable.\n                                enableCompBox.val(\"1\");\n                                str.get_strings([\n                                    {key: \"completion\", component: \"completion\"},\n                                    {key: \"completionswitchhelp\", component: \"format_tiles\"}\n                                ]).done(function (s) {\n                                    Notification.alert(\n                                        s[0],\n                                        s[1]\n                                    );\n                                });\n                            }\n                        }\n                    });\n                    $(\"select#id_enablecompletion\").change(function (e) {\n                        if (e.currentTarget.value === \"0\") {\n                            // We are changing switch completion tracking off at course level too.\n                            // See under \"completion tracking > enable.\n                            // It follows that we must be hiding progress on tiles too.\n                            $(\"select#id_courseshowtileprogress\").val(\"0\");\n                        }\n                    });\n\n                    // Create clickable colour swatch for each colour in the select drop down to help user choose.\n                    var colourSelectMenu = $(\"select#id_basecolour\");\n                    Templates.render(\"format_tiles/colour_picker\", {\n                        colours: colourSelectMenu.find(\"option\").map(\n                            function (index, option) {\n                                var optselector = $(option);\n                                var colour = optselector.attr(\"value\");\n                                return {\n                                    colour: colour,\n                                    colourname: optselector.text(),\n                                    selected: colour === colourSelectMenu.val(),\n                                    id: colour.replace(\"#\", \"\")\n                                };\n                            }\n                        ).toArray()\n                    }).done(function (html) {\n                        // Add the newly created colour picker next to the standard select menu.\n                        $(html).insertAfter(colourSelectMenu);\n                        // Now that users are using the colour circles we can hide the text menu.\n                        colourSelectMenu.hide();\n                        // Watch for clicks on each circle and set select menu to correct colour on click.\n\n                        var circles = $(\".colourpickercircle\");\n\n                        circles.click(function (e) {\n                            var clicked = $(e.currentTarget);\n                            circles.removeClass(\"selected\");\n                            clicked.addClass(\"selected\");\n                            colourSelectMenu.val(clicked.attr(\"data-colour\"));\n                            $(\"#colourselectnotify\").fadeIn(200).fadeOut(1200);\n                        });\n\n                        colourSelectMenu.change(function () {\n                            circles.removeClass(\"selected\");\n                            $(\"#colourpick_\" + colourSelectMenu.val().replace(\"#\", \"\")).addClass(\"selected\");\n                        });\n\n                        // If the course is being switched in to \"Tiles\", body will still have old format class e.g. format-topics.\n                        // This comes from core.  We want body to have format-tiles class for our colour picker CSS, so we add it.\n                        var body = $(\"body\");\n                        if (!body.hasClass(\"format-tiles\")) {\n                            body.addClass(\"format-tiles\");\n                        }\n                    });\n\n                    // If we are on the course edit settings form, render a button to be added to it.\n                    // Put it next to the existing drop down select box for course default tile icon.\n                    // Add it to the page.\n\n                    var selectedIconName;\n                    var selectBox;\n                    if (pageType === \"course-edit\") {\n                        selectBox = $(\"#id_defaulttileicon\");\n                        selectedIconName = $(\"#id_defaulttileicon option:selected\").text();\n                    } else if (pageType === \"course-editsection\") {\n                        selectBox = $(\"#id_tileicon\");\n                        selectedIconName = $(\"#id_tileicon option:selected\").text();\n                    }\n                    if (pageType === \"course-edit\" || (pageType === \"course-editsection\" && section !== \"0\")) {\n                        var currentIcon;\n                        if (selectBox.val() === \"\") {\n                            currentIcon = courseDefaultIcon;\n                        } else {\n                            currentIcon = selectBox.val();\n                        }\n                        Templates.render(\"format_tiles/icon_picker_launch_btn\", {\n                            initialicon: currentIcon,\n                            initialname: selectedIconName,\n                            sectionId: sectionId,\n                            allowphototiles: allowphototiles\n                        }).done(function (html) {\n                            $(html).insertAfter(selectBox);\n\n                            // We can hide the original select box now as users will use the button instead.\n                            selectBox.hide();\n                            require([\"format_tiles/edit_icon_picker\"], function(iconPicker) {\n                                iconPicker.init(courseId, pageType, allowphototiles, documentationUrl);\n                            });\n                        });\n                    } else if (pageType === \"course-editsection\" && section === \"0\") {\n                        selectBox.closest(\".row\").hide(); // Don't have an icon for section zero.\n                    }\n\n                    // Add a row to the page with link to plugin documentation.\n                    Templates\n                        .render(\"format_tiles/edit_form_helptext\", {documentationurl: documentationUrl + '/teacher'})\n                        .done(function (html) {\n                            $(html).appendTo($(\"#id_courseformathdr .fcontainer\"));\n                        });\n\n                    // Clean up all browser storage since the settings may have changed so stored content is wrong.\n                    browserStorage.init(courseId, 1, true, 1, 0, true, userId);\n                    browserStorage.cleanUpStorage();\n                });\n            }\n        };\n    }\n);"],"file":"edit_form_helper.min.js"}