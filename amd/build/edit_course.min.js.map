{"version":3,"sources":["../src/edit_course.js"],"names":["define","$","config","str","ajax","browserStorageEdit","Selector","EDITING_COLLAPSE_SECID","EDITING_COLLAPSE_SEC","EDITING_EXPAND_SEC","EDITING_EXPAND_SECID","ACTIVITY","SECTION_ID","TILE_TITLE","TILE_BAR_TEXT","SECTION","SECTION_MAIN","DNDUPLOAD_HIDDEN","ACTIVITYACTION","ACTIONAREA","EXPAND_ALL_BTNS","EXPAND_COLLAPSE_SEC","EDIT_TITLE_PENCIL","ICON_PICKER_BTN","TILE_BAR","SECTIONACTIONMENU","MENU_ACTION","Keyboard","ESCAPE","TAB","RETURN","Event","CLICK","KEYDOWN","SCROLL","DataAttributes","ORIG_TITLE","courseId","collapseSectionFromSecNum","secNum","section","animate","opacity","find","slideUp","addClass","removeClass","fadeOut","setSectionStatus","init","courseIdInit","useJavascriptNav","maxContentSectionsToStore","isMobile","sectionNum","storedContentExpirySecs","storedContentDeleteMins","useFilterButtons","assumeDataStoreConsent","reopenLastSection","userId","fitTilesToWidth","pageType","allowPhotoTiles","useSubTiles","areConvertingLabel","documentationurl","require","iconPicker","editCourseMod","document","ready","on","e","keyCode","target","hasClass","window","location","wwwroot","currentTarget","parent","attr","collapsingAllSectionFromURL","search","indexOf","finalSectionInCourse","last","toolTips","length","tooltip","err","log","debug","closest","sectionMain","remove"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main Javascript module for format_tiles for when user *IS* editing.\n * See course.js for if they are not editing.\n * Handles the UI changes when tiles are selected and anything else not\n * covered by the specific modules\n *\n * @module edit_course\n * @package course/format\n * @subpackage tiles\n * @copyright 2019 David Watson {@link http://evolutioncode.uk}\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since Moodle 3.3\n */\n/* global document, window */\n/* eslint space-before-function-paren: 0 */\n\ndefine(\n    [\"jquery\", \"core/config\", \"core/str\", \"core/ajax\", \"format_tiles/edit_browser_storage\"],\n    function($, config, str, ajax, browserStorageEdit) {\n        \"use strict\";\n        var Selector = {\n            EDITING_COLLAPSE_SECID: \"#collapse\",\n            EDITING_COLLAPSE_SEC: \".collapse-section\",\n            EDITING_EXPAND_SEC: \".expand-section\",\n            EDITING_EXPAND_SECID: \"#expand\",\n            ACTIVITY: \"li.activity\",\n            SECTION_ID: \"#section-\",\n            TILE_TITLE: \"li.section.main .tile_bar_text .inplaceeditable a:not(.quickeditlink)\",\n            TILE_BAR_TEXT: \".tile_bar_text\",\n            SECTION: \"ul.section\",\n            SECTION_MAIN: \"li.section.main\",\n            DNDUPLOAD_HIDDEN: \"dndupload-hidden\",\n            ACTIVITYACTION: 'a.cm-edit-action',\n            ACTIONAREA: '.actions',\n            EXPAND_ALL_BTNS: \".expand-collapse-all-btns a\",\n            EXPAND_COLLAPSE_SEC: \".expand-collapse-sec \",\n            EDIT_TITLE_PENCIL: \".quickeditlink\",\n            ICON_PICKER_BTN: \".tileiconcontainer\",\n            TILE_BAR: \".tile_bar\",\n            SECTIONACTIONMENU: '.section_action_menu',\n            MENU_ACTION: \".menu-action\"\n        };\n\n        var Keyboard = {\n            ESCAPE: 27,\n            TAB: 9,\n            RETURN: 13\n        };\n\n        var Event = {\n            CLICK: \"click\",\n            KEYDOWN: \"keydown\",\n            SCROLL: \"scroll\"\n        };\n\n        var DataAttributes = {\n            SECTION: \"data-section\",\n            ORIG_TITLE: \"data-original-title\"\n        };\n\n        var courseId;\n\n        /**\n         * Collapse a given section according to the collapse button pressed.\n         * @param {number} secNum\n         */\n        var collapseSectionFromSecNum = function(secNum) {\n            var section = $(Selector.SECTION_ID + secNum);\n            $(Selector.SECTION_ID + secNum + \"-content\").animate({opacity: 0}, 300);\n            section.find(Selector.ACTIVITY).slideUp(500);\n            section.find(\".section-modchooser\").slideUp(500);\n            section.addClass(\"collapsed\").removeClass(\"expanded\");\n            section.find(\".mod-chooser-outer\").fadeOut(500);\n            browserStorageEdit.setSectionStatus(secNum, false);\n        };\n\n        return {\n            // All args down to \"filttilestowidth\" are copied from course.js.\n            init: function(\n                courseIdInit,\n                useJavascriptNav, // Set by site admin see settings.php.\n                maxContentSectionsToStore, // Set by site admin see settings.php.\n                isMobile,\n                sectionNum,\n                storedContentExpirySecs, // Set by site admin see settings.php.\n                storedContentDeleteMins, // Set by site admin see settings.php.\n                useFilterButtons,\n                assumeDataStoreConsent, // Set by site admin see settings.php.\n                reopenLastSection, // Set by site admin see settings.php.\n                userId,\n                fitTilesToWidth,\n                pageType,\n                allowPhotoTiles,\n                useSubTiles,\n                areConvertingLabel,\n                documentationurl\n            ) {\n                courseId = courseIdInit;\n                // Some args are strings or ints but we prefer bool.  Change to bool now as they are passed on elsewhere.\n                assumeDataStoreConsent = assumeDataStoreConsent === \"1\";\n                // This is also called from lib.php, via edit_form_helper, if user is on course/edit.php or editsection.php.\n                require(['format_tiles/edit_icon_picker'], function(iconPicker) {\n                    iconPicker.init(courseId, pageType, allowPhotoTiles, documentationurl);\n                });\n\n                if (useSubTiles) {\n                    require(['format_tiles/edit_course_mod'], function (editCourseMod) {\n                        editCourseMod.init(\n                            courseId,\n                            sectionNum,\n                            areConvertingLabel\n                        );\n                    });\n                }\n\n                $(document).ready(function() {\n                    $(Selector.TILE_BAR_TEXT).on(Event.KEYDOWN, function(e) {\n                        if (e.keyCode === Keyboard.RETURN && !$(e.target).hasClass('form-control')) {\n                            // Return key has been pressed and *not* while the user was inplace editing the title.\n                            window.location = config.wwwroot + '/course/view.php?id=' + courseId\n                                + '&section=' + $(e.currentTarget).parent().attr(DataAttributes.SECTION);\n                        }\n                    });\n\n                    // If the user preference is for JS off, or site admin has disabled, or user is mobile, no JS nav.\n                    if (useJavascriptNav && !isMobile) {\n                        var collapsingAllSectionFromURL = (window.location.search).indexOf(\"expanded=-1\") !== -1;\n                        var finalSectionInCourse = $(Selector.SECTION_MAIN).last().attr(\"data-section\");\n                        browserStorageEdit.init(\n                            userId,\n                            courseId,\n                            maxContentSectionsToStore,\n                            storedContentDeleteMins,\n                            assumeDataStoreConsent,\n                            finalSectionInCourse,\n                            collapsingAllSectionFromURL\n                        );\n                    }\n\n                    if (!isMobile) {\n                        // Initialise tooltips shown for example when hover over tile icon \"Click to change icon\".\n                        // But not on mobile as they make clicks harder.\n                        var toolTips = $(\"[data-toggle=tooltip]\");\n                        if (toolTips.length !== 0) {\n                            try {\n                                toolTips.tooltip();\n                            } catch (err) {\n                                require([\"core/log\"], function(log) {\n                                    log.debug(err);\n                                });\n                            }\n                        }\n                    }\n\n                    // We don't want to re-implement show/hide sections, so we let core handle it.\n                    // Core will re-render all activties when it hides section, and they will be in non subtiles form.\n                    // So we just delete them and can add them back when we un-hide or expand.\n                    $('body').on('click keypress', Selector.SECTION_MAIN + ' ' +\n                        Selector.SECTIONACTIONMENU + '[data-sectionid] ' +\n                        'a[data-action]', function(e) {\n                            var target = $(e.target).closest(Selector.MENU_ACTION);\n                            var sectionMain = target.closest(Selector.SECTION_MAIN);\n                            if (target.attr(\"data-action\") === \"hide\" || target.attr(\"data-action\") === \"show\") {\n                                // If teacher has clicked \"show\" we still collapse sec to hide the core change - they can re-expand.\n                                collapseSectionFromSecNum(sectionMain.attr(\"data-section\"));\n                                sectionMain.find(Selector.SECTION).find(Selector.ACTIVITY).slideUp(300).remove();\n                            }\n                        });\n                });\n            }\n        };\n    }\n);"],"file":"edit_course.min.js"}